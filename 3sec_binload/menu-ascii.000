0010 ;System equates used
0020 LINZBS = $00
0030 TRAMSZ = $06
0040 BOOT   = $09
0050 ICSTAZ = $23
0060 ICSPRZ = $2C
0070 SOUNDR = $41
0080 FMSZPG = $43
0090 SDMCTL = $022F
0100 SDLSTL = $0230
0110 SDLSTH = $0231
0120 COLDST = $0244
0130 GLBABS = $02E0
0140 DUNIT  = $0301
0150 DSTATS = $0303
0160 DBUFHI = $0305
0170 DTIMLO = $0306
0180 DBYTLO = $0308
0190 DAUX1  = $030A
0200 DAUX2  = $030B
0210 KEYBDV = $E420
0220 SIOV   = $E459
0230 ;End of system equates
0240 ;Zero-page equates
0250 Z0001  = $A0
0260 Z0002  = $B2
0270 Z0003  = $B3
0280 Z0004  = $B1
0290 Z0009  = $B0
0300 Z0011  = $C0
0310 Z0013  = $E0
0320 ;End of zero-page equates
0330        *=  $0700
0340        BRK
0350        .BYTE $03
0360        BRK
0370        .BYTE $07,$77
0380        CPX Z0001 ;$00A0
0390        BRK
0400        STY COLDST ;$0244
0410        INY
0420        STY BOOT ;$0009
0430        STY DUNIT ;$0301
0440        DEC DTIMLO ;$0306
0450        LDA #$4A
0460        STA SDLSTL ;$0230
0470        LDA #$08
0480        STA SDLSTH ;$0231
0490        LDA #$7C
0500        STA Z0002 ;$00B2
0510        LDA #$08
0520        STA Z0003 ;$00B3
0530        LDA #$69
0540        STA Z0004 ;$00B1
0550 L0018  LDA Z0004 ;$00B1
0560        STA DAUX1 ;$030A
0570        LDA #$01
0580        STA DAUX2 ;$030B
0590        JSR L0005 ;$080B
0600        INC Z0004 ;$00B1
0610        DEX
0620 L0017  LDA L0006,X ;$0B00
0630        BEQ L0007 ;$078E
0640        BMI L0008 ;$0782
0650        CMP #$01
0660        BEQ L0008 ;$0782
0670        INC Z0009 ;$00B0
0680        LDY Z0009 ;$00B0
0690        LDA L0010,X ;$0B03
0700        .BYTE $99,$C0,$00
0710        LDA L0012,X ;$0B04
0720        .BYTE $99,$E0,$00
0730        TYA
0740        CLC
0750        ADC #$A0
0760        LDY #$03
0770        STA (Z0002),Y ;$00B2
0780        INY
0790        LDA #$8E
0800        STA (Z0002),Y ;$00B2
0810        INY
0820 L0015  INY
0830        LDA L0014,X ;$0B05
0840        INX
0850        SEC
0860        SBC #$20
0870        STA (Z0002),Y ;$00B2
0880        CPY #$10
0890        BNE L0015 ;$0763
0900        CLC
0910        LDA Z0002 ;$00B2
0920        ADC #$14
0930        STA Z0002 ;$00B2
0940        BCC L0016 ;$077C
0950        INC Z0003 ;$00B3
0960 L0016  LDA Z0009 ;$00B0
0970        CMP #$14
0980        BEQ L0007 ;$078E
0990 L0008  TXA
1000        AND #$F0
1010        CLC
1020        ADC #$10
1030        TAX
1040        ASL A
1050        BCC L0017 ;$073A
1060        BCS L0018 ;$072A
1070 L0007  JSR L0019 ;$0841
1080        SEC
1090        SBC #$40
1100        CMP Z0009 ;$00B0
1110        BEQ L0020 ;$079A
1120        BCS L0007 ;$078E
1130 L0020  TAX
1140        INC L0021,X ;$0850
1150        LDA Z0011,X ;$00C0
1160        STA DAUX1 ;$030A
1170        LDA Z0013,X ;$00E0
1180        STA DAUX2 ;$030B
1190        JSR L0022 ;$0815
1200        DEX
1210 L0024  JSR L0023 ;$07F9
1220        STA FMSZPG ;$0043
1230        JSR L0023 ;$07F9
1240        STA FMSZPG+1 ;$0044
1250        AND FMSZPG ;$0043
1260        CMP #$FF
1270        BEQ L0024 ;$07AC
1280        JSR L0023 ;$07F9
1290        STA FMSZPG+2 ;$0045
1300        JSR L0023 ;$07F9
1310        STA FMSZPG+3 ;$0046
1320 L0027  JSR L0023 ;$07F9
1330        STA (FMSZPG),Y ;$0043
1340        INC FMSZPG ;$0043
1350        BNE L0025 ;$07D3
1360        INC FMSZPG+1 ;$0044
1370        BEQ L0026 ;$07DD
1380 L0025  LDA FMSZPG+2 ;$0045
1390        CMP FMSZPG ;$0043
1400        LDA FMSZPG+3 ;$0046
1410        SBC FMSZPG+1 ;$0044
1420        BCS L0027 ;$07C6
1430 L0026  LDA GLBABS+2 ;$02E2
1440        ORA GLBABS+3 ;$02E3
1450        BEQ L0024 ;$07AC
1460        STX FMSZPG+6 ;$0049
1470        JSR L0028 ;$07F6
1480        LDX FMSZPG+6 ;$0049
1490        LDY #$00
1500        STY GLBABS+2 ;$02E2
1510        STY GLBABS+3 ;$02E3
1520        BEQ L0024 ;$07AC
1530 L0028  JMP (GLBABS+2) ;$02E2
1540 L0023  CPX #$7D
1550        BNE L0029 ;$083C
1560        LDA DAUX1 ;$030A
1570        ORA DAUX2 ;$030B
1580        BNE L0022 ;$0815
1590        STA SDMCTL ;$022F
1600        JMP (GLBABS) ;$02E0
1610 L0005  LDA #$0B
1620        STA DBUFHI ;$0305
1630        LDA #$80
1640    C   STA DBYTLO ;$0308
1650 L0022  LDA #$40
1660        STA DSTATS ;$0303
1670        JSR SIOV ;$E459
1680        BMI L0022 ;$0815
1690        LDA L0030 ;$0B7D
1700        AND #$03
1710        STA DAUX2 ;$030B
1720        LDA L0031 ;$0B7E
1730        STA DAUX1 ;$030A
1740        STA L0032 ;$D017
1750        LDA L0033 ;$0B7F
1760        AND #$7F
1770        STA L0034 ;$07FA
1780        LDY #$00
1790        LDX #$00
1800 L0029  LDA L0006,X ;$0B00
1810        INX
1820        RTS
1830 L0019  LDA KEYBDV+5 ;$E425
1840        PHA
1850        LDA KEYBDV+4 ;$E424
1860        PHA
1870        RTS
1880        BVS L0035 ;$08BC
1890        BVS L0036 ;$0895
1900        PLA
1910        PHP
1920 L0021  BVS L0037 ;$0858
1930        ASL TRAMSZ ;$0006
1940        ASL TRAMSZ ;$0006
1950        ASL TRAMSZ ;$0006
1960 L0037  ASL TRAMSZ ;$0006
1970        ASL TRAMSZ ;$0006
1980        ASL TRAMSZ ;$0006
1990        ASL TRAMSZ ;$0006
2000        ASL TRAMSZ ;$0006
2010        ASL TRAMSZ ;$0006
2020        ASL SOUNDR ;$0041
2030        LSR A
2040        PHP
2050        BRK
2060        BRK
2070        BRK
2080        AND L0038 ;$2B21
2090        AND LINZBS ;$0000
2100        .BYTE $33
2110        AND ICSPRZ ;$002C
2120        AND ICSTAZ ;$0023
2130        .BYTE $34
2140        AND #$2F
2150        .BYTE $2E,$00,$00
2160        BRK
2170        BRK
2180        BRK
2190        BRK
2200        BRK
2210 ;External reference equates
2220 L0006  = $0B00
2230 L0010  = $0B03
2240 L0012  = $0B04
2250 L0014  = $0B05
2260 L0030  = $0B7D
2270 L0031  = $0B7E
2280 L0032  = $D017
2290 L0033  = $0B7F
2300 L0034  = $07FA
2310 L0035  = $08BC
2320 L0036  = $0895
2330 L0038  = $2B21
2340 ;End of external references
2350        .END      
